/* global wp, ernestGutenbergTableConfig */

'use strict';

const {
  useEffect,
  useState
} = wp.element;
const {
  registerBlockType
} = wp.blocks;
const {
  serverSideRender: ServerSideRender = wp.components.ServerSideRender
} = wp;
const {
  ToggleControl,
  PanelBody,
  Placeholder
} = wp.components;
const {
  InspectorControls,
  useBlockProps
} = wp.blockEditor || wp.editor;
registerBlockType('ernest/table', {
  title: ernestGutenbergTableConfig.i18n.title,
  description: ernestGutenbergTableConfig.i18n.description,
  category: 'widgets',
  attributes: {
    id: {
      type: 'boolean',
      default: true
    },
    fname: {
      type: 'boolean',
      default: true
    },
    lname: {
      type: 'boolean',
      default: true
    },
    email: {
      type: 'boolean',
      default: true
    },
    date: {
      type: 'boolean',
      default: true
    }
  },
  edit: ({
    attributes,
    setAttributes
  }) => {
    const {
      id,
      fname,
      lname,
      email,
      date
    } = attributes;
    const [tableData, setMyData] = useState([]);
    function fetchData() {
      wp.ajax.post('ernest_get_table', {}).done(function (response) {
        setMyData(response);
      });
    }
    const toggleAttribute = attribute => value => {
      setAttributes({
        [attribute]: value
      });
    };
    useEffect(() => {
      fetchData();
    }, [id, fname, lname, email, date]);
    return React.createElement("div", {
      className: "wp-block-table"
    }, React.createElement("h1", null, "Ernest API Table edit"), tableData.length > 0 && React.createElement("table", null, React.createElement("thead", null, React.createElement("tr", null, React.createElement("th", null, "Column 1"), React.createElement("th", null, "Column 2"))), React.createElement("tbody", null, tableData.map(row => React.createElement("tr", {
      key: row.id
    }, React.createElement("td", null, row.column1), React.createElement("td", null, row.column2))))), React.createElement(InspectorControls, null, React.createElement(PanelBody, {
      title: "Settings"
    }, React.createElement(ToggleControl, {
      label: "Display ID column",
      checked: id,
      onChange: toggleAttribute('id')
    }), React.createElement(ToggleControl, {
      label: "Display First Name column",
      checked: fname,
      onChange: toggleAttribute('fname')
    }), React.createElement(ToggleControl, {
      label: "Display Last Name column",
      checked: lname,
      onChange: toggleAttribute('lname')
    }), React.createElement(ToggleControl, {
      label: "Display Email column",
      checked: email,
      onChange: toggleAttribute('email')
    }), React.createElement(ToggleControl, {
      label: "Display Date column",
      checked: date,
      onChange: toggleAttribute('date')
    }))));
  },
  save(props) {
    const {
      attributes: {
        id,
        fname,
        lname,
        email,
        date
      }
    } = props;
    const dataAttributes = {
      id: id,
      firstName: fname,
      lastName: lname,
      email: email,
      date: date
    };
    return React.createElement("div", {
      className: "wp-block-table"
    }, React.createElement("h1", null, "Ernest API Table"), React.createElement("table", {
      className: "ernest",
      "data-columns": JSON.stringify(dataAttributes)
    }));
  }
});